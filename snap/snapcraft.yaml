name: iotdevice-pi-bluetooth
version: '1.0'
summary: Setup Bluetooth on Raspberry Pi running Ubuntu Core
description: |
  Confined snap meant to enable bluetooth on RPi devices on Ubuntu Core systems
grade: stable
confinement: strict
base: core22
architectures:
  - build-on: [amd64, arm64]
    build-for: arm64
  - build-on: [amd64, armhf]
    build-for: armhf

apps:
  btuart:
    command: bin/btuart
    daemon: forking
    install-mode: disable
    plugs:
      - serial-port
      - hardware-observe
      - bluetooth-control
  bthelper:
    command: bin/bthelper
    daemon: oneshot
    install-mode: disable
    after:
      - btuart
    plugs:
      - serial-port
      - hardware-observe
      - bluetooth-control
      - network-observe

parts:
  file-dump:
    plugin: dump
    source: dump
  bluez:
    plugin: nil
    override-pull: |
      UBUNTU_STORE_ARCH=$CRAFT_TARGET_ARCH snap download bluez --channel=22/stable
      find *.snap -exec unsquashfs -f -d $CRAFT_PART_INSTALL {} \;
    prime:
      - usr/bin/hciconfig
      - usr/bin/hcidump
      - usr/bin/hciattach
      - usr/bin/hcitool
